<!DOCTYPE html>
<html lang="en-us">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  <meta name="author" content="21song">
  
  
  
  <link rel="prev" href="/2017/django%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%A7%8B/" />
  <link rel="next" href="/2017/djangomysql%E6%95%B0%E6%8D%AE%E5%BA%93%E6%97%A5%E5%BF%97/" />
  <link rel="canonical" href="/2017/django%E7%9A%84%E5%AE%9A%E4%B9%89%E6%A8%A1%E5%9E%8B%E7%B1%BB/" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           Django的定义模型类 | 宋军亮的技术博客
       
  </title>
  <meta name="title" content="Django的定义模型类 | 宋军亮的技术博客">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  
  
 

<script type="application/ld+json">
 "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "\/"
    },
    "articleSection" : "posts",
    "name" : "Django的定义模型类",
    "headline" : "Django的定义模型类",
    "description" : "模型类被定义在\x26rdquo;应用\/models.py\x26rdquo;文件中。 模型类必须继承自Model类，位于包django.db.models中。  接下来首先以\x26rdquo;图书-人物\x26rdquo;管理为例进行演示。\n1 定义 在models.py 文件中定义模型类。\nfrom django.db import models # Create your models here. # 准备书籍列表信息的模型类 class BookInfo(models.Model): # 创建字段，字段类型... name = models.CharField(max_length=20, verbose_name=\x27名称\x27) pub_date = models.DateField(verbose_name=\x27发布日期\x27,null=True) readcount = models.IntegerField(default=0, verbose_name=\x27阅读量\x27) commentcount = models.IntegerField(default=0, verbose_name=\x27评论量\x27) is_delete = models.BooleanField(default=False, verbose_name=\x27逻辑删除\x27) class Meta: db_table = \x27bookinfo\x27 # 指明数据库表名 verbose_name = \x27图书\x27 # 在admin站点中显示的名称 def __str__(self): \x26quot;\x26quot;\x26quot;定义每个数据对象的显示信息\x26quot;\x26quot;\x26quot; return self.name # 准备人物列表信息的模型类 class PeopleInfo(models.Model): GENDER_CHOICES = ( (0, \x27male\x27), (1, \x27female\x27) ) name = models.",
    "inLanguage" : "en-us",
    "author" : "Song",
    "creator" : "Song",
    "publisher": "Song",
    "accountablePerson" : "Song",
    "copyrightHolder" : "Song",
    "copyrightYear" : "2017",
    "datePublished": "2017-11-09 00:00:00 \x2b0000 UTC",
    "dateModified" : "2017-11-09 00:00:00 \x2b0000 UTC",
    "url" : "\/2017\/django%E7%9A%84%E5%AE%9A%E4%B9%89%E6%A8%A1%E5%9E%8B%E7%B1%BB\/",
    "wordCount" : "319",
    "keywords" : [ "Python","Django", "宋军亮的技术博客"]
}
</script>

</head>

  


  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="/">宋军亮的技术博客</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="/">宋军亮的技术博客</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
    	 <main class="main">
          <div class="container">
      		
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">Django的定义模型类</h1>
        <div class="post-meta">
                Written by <a itemprop="name" href="/" rel="author">Song</a> with ♥ 
                <span class="post-time">
                on <time datetime=2017-11-09 itemprop="datePublished">November 9, 2017</time>
                </span>
                in
                <i class="iconfont icon-folder"></i>
                <span class="post-category">
                        <a href="/categories/python/"> Python </a>
                        
                </span>
        </div>
    </header>
    <div class="post-content">
        

        

        
        
     
          
          
          

          
          
          

          

<ul>
<li>模型类被定义在&rdquo;应用/models.py&rdquo;文件中。</li>
<li>模型类必须继承自Model类，位于包django.db.models中。</li>
</ul>

<p>接下来首先以&rdquo;图书-人物&rdquo;管理为例进行演示。</p>

<h2 id="1-定义">1 定义</h2>

<p>在models.py 文件中定义模型类。</p>

<pre><code class="language-python">from django.db import models

# Create your models here.
# 准备书籍列表信息的模型类
class BookInfo(models.Model):
    # 创建字段，字段类型...
    name = models.CharField(max_length=20, verbose_name='名称')
    pub_date = models.DateField(verbose_name='发布日期',null=True)
    readcount = models.IntegerField(default=0, verbose_name='阅读量')
    commentcount = models.IntegerField(default=0, verbose_name='评论量')
    is_delete = models.BooleanField(default=False, verbose_name='逻辑删除')

    class Meta:
        db_table = 'bookinfo'  # 指明数据库表名
        verbose_name = '图书'  # 在admin站点中显示的名称

    def __str__(self):
        &quot;&quot;&quot;定义每个数据对象的显示信息&quot;&quot;&quot;
        return self.name

# 准备人物列表信息的模型类
class PeopleInfo(models.Model):
    GENDER_CHOICES = (
        (0, 'male'),
        (1, 'female')
    )
    name = models.CharField(max_length=20, verbose_name='名称')
    gender = models.SmallIntegerField(choices=GENDER_CHOICES, default=0, verbose_name='性别')
    description = models.CharField(max_length=200, null=True, verbose_name='描述信息')
    book = models.ForeignKey(BookInfo, on_delete=models.CASCADE, verbose_name='图书')  # 外键
    is_delete = models.BooleanField(default=False, verbose_name='逻辑删除')

    class Meta:
        db_table = 'peopleinfo'
        verbose_name = '人物信息'

    def __str__(self):
        return self.name
</code></pre>

<p><strong>1） 数据库表名</strong></p>

<p>模型类如果未指明表名，Django默认以<strong>小写app应用名_小写模型类名</strong>为数据库表名。</p>

<p>可通过<strong>db_table</strong>指明数据库表名。</p>

<p><strong>2） 关于主键</strong></p>

<p>django会为表创建自动增长的主键列，每个模型只能有一个主键列，如果使用选项设置某属性为主键列后django不会再创建自动增长的主键列。</p>

<p>默认创建的主键列属性为id，可以使用pk代替，pk全拼为primary key。</p>

<p><strong>3） 属性命名限制</strong></p>

<ul>
<li><p>不能是python的保留关键字。</p></li>

<li><p>不允许使用连续的下划线，这是由django的查询方式决定的。</p></li>

<li><p>定义属性时需要指定字段类型，通过字段类型的参数指定选项，语法如下：</p></li>
</ul>

<pre><code class="language-python">  属性=models.字段类型(选项)
</code></pre>

<p><strong>4）字段类型</strong></p>

<table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">说明</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left">AutoField</td>
<td align="left">自动增长的IntegerField，通常不用指定，不指定时Django会自动创建属性名为id的自动增长属性</td>
</tr>

<tr>
<td align="left">BooleanField</td>
<td align="left">布尔字段，值为True或False</td>
</tr>

<tr>
<td align="left">NullBooleanField</td>
<td align="left">支持Null、True、False三种值</td>
</tr>

<tr>
<td align="left">CharField</td>
<td align="left">字符串，参数max_length表示最大字符个数</td>
</tr>

<tr>
<td align="left">TextField</td>
<td align="left">大文本字段，一般超过4000个字符时使用</td>
</tr>

<tr>
<td align="left">IntegerField</td>
<td align="left">整数</td>
</tr>

<tr>
<td align="left">DecimalField</td>
<td align="left">十进制浮点数， 参数max_digits表示总位数， 参数decimal_places表示小数位数</td>
</tr>

<tr>
<td align="left">FloatField</td>
<td align="left">浮点数</td>
</tr>

<tr>
<td align="left">DateField</td>
<td align="left">日期， 参数auto_now表示每次保存对象时，自动设置该字段为当前时间，用于&rdquo;最后一次修改&rdquo;的时间戳，它总是使用当前日期，默认为False； 参数auto_now_add表示当对象第一次被创建时自动设置当前时间，用于创建的时间戳，它总是使用当前日期，默认为False; 参数auto_now_add和auto_now是相互排斥的，组合将会发生错误</td>
</tr>

<tr>
<td align="left">TimeField</td>
<td align="left">时间，参数同DateField</td>
</tr>

<tr>
<td align="left">DateTimeField</td>
<td align="left">日期时间，参数同DateField</td>
</tr>

<tr>
<td align="left">FileField</td>
<td align="left">上传文件字段</td>
</tr>

<tr>
<td align="left">ImageField</td>
<td align="left">继承于FileField，对上传的内容进行校验，确保是有效的图片</td>
</tr>
</tbody>
</table>

<p><strong>5） 选项</strong></p>

<table>
<thead>
<tr>
<th align="left">选项</th>
<th align="left">说明</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left">null</td>
<td align="left">如果为True，表示允许为空，默认值是False</td>
</tr>

<tr>
<td align="left">blank</td>
<td align="left">如果为True，则该字段允许为空白，默认值是False</td>
</tr>

<tr>
<td align="left">db_column</td>
<td align="left">字段的名称，如果未指定，则使用属性的名称</td>
</tr>

<tr>
<td align="left">db_index</td>
<td align="left">若值为True, 则在表中会为此字段创建索引，默认值是False</td>
</tr>

<tr>
<td align="left">default</td>
<td align="left">默认</td>
</tr>

<tr>
<td align="left">primary_key</td>
<td align="left">若为True，则该字段会成为模型的主键字段，默认值是False，一般作为AutoField的选项使用</td>
</tr>

<tr>
<td align="left">unique</td>
<td align="left">如果为True, 这个字段在表中必须有唯一值，默认值是False</td>
</tr>
</tbody>
</table>

<p><strong>null是数据库范畴的概念，blank是表单验证范畴的</strong></p>

<p><strong>6） 外键</strong></p>

<p>在设置外键时，需要通过<strong>on_delete</strong>选项指明主表删除数据时，对于外键引用表数据如何处理，在django.db.models中包含了可选常量：</p>

<ul>
<li><strong>CASCADE</strong>级联，删除主表数据时连通一起删除外键表中数据</li>
<li><strong>PROTECT</strong>保护，通过抛出<strong>ProtectedError</strong>异常，来阻止删除主表中被外键应用的数据</li>
<li><strong>SET_NULL</strong>设置为NULL，仅在该字段null=True允许为null时可用</li>
<li><strong>SET_DEFAULT</strong>设置为默认值，仅在该字段设置了默认值时可用</li>
<li><strong>SET()</strong>设置为特定值或者调用特定方法</li>
<li><strong>DO_NOTHING</strong>不做任何操作，如果数据库前置指明级联性，此选项会抛出<strong>IntegrityError</strong>异常</li>
</ul>

<h2 id="2-迁移">2 迁移</h2>

<p>将模型类同步到数据库中。</p>

<p><strong>1）生成迁移文件</strong></p>

<pre><code class="language-python">python manage.py makemigrations
</code></pre>

<p><strong>2）同步到数据库中</strong></p>

<pre><code class="language-python">python manage.py migrate
</code></pre>

<h2 id="3-添加测试数据">3 添加测试数据</h2>

<pre><code class="language-python">insert into bookinfo(name, pub_date, readcount,commentcount, is_delete) values
('射雕英雄传', '1980-5-1', 12, 34, 0),
('天龙八部', '1986-7-24', 36, 40, 0),
('笑傲江湖', '1995-12-24', 20, 80, 0),
('雪山飞狐', '1987-11-11', 58, 24, 0);
insert into peopleinfo(name, gender, book_id, description, is_delete)  values
    ('郭靖', 1, 1, '降龙十八掌', 0),
    ('黄蓉', 0, 1, '打狗棍法', 0),
    ('黄药师', 1, 1, '弹指神通', 0),
    ('欧阳锋', 1, 1, '蛤蟆功', 0),
    ('梅超风', 0, 1, '九阴白骨爪', 0),
    ('乔峰', 1, 2, '降龙十八掌', 0),
    ('段誉', 1, 2, '六脉神剑', 0),
    ('虚竹', 1, 2, '天山六阳掌', 0),
    ('王语嫣', 0, 2, '神仙姐姐', 0),
    ('令狐冲', 1, 3, '独孤九剑', 0),
    ('任盈盈', 0, 3, '弹琴', 0),
    ('岳不群', 1, 3, '华山剑法', 0),
    ('东方不败', 0, 3, '葵花宝典', 0),
    ('胡斐', 1, 4, '胡家刀法', 0),
    ('苗若兰', 0, 4, '黄衣', 0),
    ('程灵素', 0, 4, '医术', 0),
    ('袁紫衣', 0, 4, '六合拳', 0);
</code></pre>

    </div>

    <div class="post-copyright">
             
            <p class="copyright-item">
                <span>Author:</span>
                <span>21song </span>
                </p>
            
           
             
            <p class="copyright-item">
                    <span>Link:</span>
                    <a href=/2017/django%E7%9A%84%E5%AE%9A%E4%B9%89%E6%A8%A1%E5%9E%8B%E7%B1%BB/>/2017/django%E7%9A%84%E5%AE%9A%E4%B9%89%E6%A8%A1%E5%9E%8B%E7%B1%BB/</span>
            </p>
            
            
    </div>

  
    <div class="post-tags">
        
            <section>
            <i class="iconfont icon-tag"></i>Tag(s): 
            
            <span class="tag"><a href="/tags/python/">
                    #Python</a></span>
            
            <span class="tag"><a href="/tags/django/">
                    #Django</a></span>
            
            </section>
        
        <section>
                <a href="javascript:window.history.back();">back</a></span> · 
                <span><a href="/">home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="/2017/django%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%A7%8B/" class="prev" rel="prev" title="Django项目是如何开始的"><i class="iconfont icon-left"></i>&nbsp;Django项目是如何开始的</a>
         
        
        <a href="/2017/djangomysql%E6%95%B0%E6%8D%AE%E5%BA%93%E6%97%A5%E5%BF%97/" class="next" rel="next" title="Django增删改查（CUSD）">Django增删改查（CUSD）&nbsp;<i class="iconfont icon-right"></i></a>
        
    </div>

    <div class="post-comment">
          
                 
          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2016 - 2019</span>
        
        <span class="with-love">
    	 <i class="iconfont icon-love"></i> 
         </span>
         
            <span class="author" itemprop="copyrightHolder"><a href="/">21song</a> | </span> 
         

         
		  <span>Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow">Hugo</a> & <a href="https://github.com/liuzc/leaveit" target="_blank" rel="external nofollow">LeaveIt</a></span> 
    </div>
</footer>












    
    
    <script src="/js/vendor_no_gallery.min.js" async=""></script>
    
  



     </div>
  </body>
</html>
